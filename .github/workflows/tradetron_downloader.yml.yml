name: TradeTron Smart Downloader

on:

  workflow_dispatch:
    # Allows manual trigger from the GitHub UI

jobs:
  download-and-upload:
    runs-on: ubuntu-latest

    steps:
      - name: üõí Checkout Repository
        uses: actions/checkout@v4

      - name: üêç Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: üì¶ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas supabase playwright google-api-python-client google-auth python-dotenv
          # Install Playwright browser and its system dependencies
          playwright install chromium --with-deps

      - name: üöÄ Run Smart Downloader
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          SOURCE_FOLDER: ${{ secrets.SOURCE_FOLDER }}
          GDRIVE_SERVICE_ACCOUNT_JSON: ${{ secrets.GDRIVE_SERVICE_ACCOUNT_JSON }}
        run: |
          # Ensure the script path matches your repository structure
          python scripts/0_trade_downloader.py

      - name: üìÅ Upload Logs (Optional)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: execution-logs
          path: |
            *.log
            # Add any error screenshots if you implement page.screenshot()
